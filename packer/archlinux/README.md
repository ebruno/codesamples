# Sample Packer projects #

All projects build a virtual machine that is configured to run
lint or sanity on c/c++, python and various scripting languages
(dash, bash, ksh, zsh).
gitlab-runner is also installed and is ready to be connected to
a gitlab server. A unique public/private key is generated for
each build. The public key is installed for both root and builduser
accounts by default.

This has been tested on the following operating systems:

 * Debain 13
 * Fedora 42

Issues:
The display current IP on the login screen feature is inconsistent.

## Common Inputs ##

 | Name                | Description  | Type | Default | Required | Adjust for deployment environment |
 |:--------------------|:-------------|:-----|:--------|:--------:|:--------------------:|
 | builduser\_passwd   | Password for builduser default is packer | `string` | n/a | yes |
 | efi\_firmware\_code | The location and name of this may vary across operating systems. | `string` | `"/usr/share/OVMF/OVMF_CODE_4M.fd"` | yes | yes |
 | efi\_firmware\_vars | The location and name of this may vary across operating systems. | `string` | `"/usr/share/OVMF/OVMF_VARS_4M.fd"` | yes | yes |
 | hostname | Hostname | `string` | `"archlinuxvmNN"` | no |
 | install\_ssh\_key   | Indicates if the systems unique ssh should be installed for the default users | `string` | `root builduser` | no | optional |
 | iso\_checksum | Check sum for iso file | `string` | n/a | yes | auto detected |
 | iso\_url | URL for iso file | `string` | n/a | yes | yes |
 | libvirt\_nvram\_dir| Location for virtual machine nvram files in your environment | `string` | `"/var/lib/libvirt/qemu/nvram"` | yes | yes |
 | libvirt\_vm\_image\_dir | Location for virtual machine images in your environment | `string` | `"/var/lib/libvirt/images"` | yes | yes |
 | libvirt\_owner | Owner virtual machine images in your environment | `string` | `"root"` | yes | yes |
 | libvirt\_group | Group for virtual machine images in your environment | `string` | `"root"` | yes | yes |
 | nvram\_owner | Owner virtual machine nvram in your environment | `string` | `"root"` | yes | yes |
 | nvram\_group | Group for virtual machine nvram in your environment | `string` | `"root"` | yes | yes |
 | public\_key | Public ssh key for installation | `string` | n/a | yes | autogenerated |
 | root\_passwd | Password for root default is packer | `string` | n/a | yes | yes |
 | vm\_name | Name of qcow2 image file to be exported. | `string` | `"archlinux-2025.08.01-x86_64"` | yes | yes |

Note: The following must set the following variables for enviroment you are deploying in/to:

 * libvirt\_vm\_image_dir
 * libvirt\_nvram\_dir

The common defaults are:

 * libvirt\_vm\_image_dir=/var/lib/libvirt/images
 * libvirt\_nvram\_dir=/var/lib/libvirt/qemu/nvram


## Common Outputs #

Script to create the xml to install the vm on a KVM/QEMU host.

## Installing Packer ##

Current installation instructions can be found here:


[Installing Packer](https://developer.hashicorp.com/packer/install)

## Recommended User groups ##
It is recommended that user running packer are part of libvirt and kvm groups.

	  sudo usermod -aG libvirt $USER
	  sudo usermod -aG kvm $USER

## ArchLinux ##

The following scripts are uploaded to image and then used to create the image.
Addtionial scripts are in the hcl file.

The hcl file will create a script create\_archlinux-2025.08.01-x86_64_vm.sh
that will create the vm's xml file and then install the vm.
